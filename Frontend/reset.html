<!-- reset.html -->
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Reset password</title></head>
<body>
  <h2>Choose a new password</h2>
  <form id="resetForm">
    <input id="pw" type="password" placeholder="New password" minlength="6" required/>
    <input id="pw2" type="password" placeholder="Confirm password" minlength="6" required/>
    <button type="submit">Reset password</button>
  </form>
  <div id="msg"></div>

  <script>
    const API_BASE = 'http://localhost:5000/api/auth';
    function getQuery(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }
    const token = getQuery('token');
    if (!token) {
      document.getElementById('msg').textContent = 'Missing token';
    }

    document.getElementById('resetForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const pw = document.getElementById('pw').value;
      const pw2 = document.getElementById('pw2').value;
      const msg = document.getElementById('msg');
      if (pw !== pw2) { msg.style.color='crimson'; msg.textContent='Passwords do not match'; return; }

      try {
        const res = await fetch(`${API_BASE}/reset`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, password: pw })
        });
        const data = await res.json();
        if (res.ok) {
          msg.style.color = 'green';
          msg.textContent = data.message || 'Password changed';
          setTimeout(() => { window.location = 'index.html'; }, 1500);
        } else {
          msg.style.color = 'crimson';
          msg.textContent = data.error || 'Failed';
        }
      } catch (err) {
        msg.style.color = 'crimson'; msg.textContent = 'Network error';
      }
    });
  </script>
</body>
</html>
