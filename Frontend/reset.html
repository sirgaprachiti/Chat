



<!-- reset.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reset password</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    :root {
      --brand: #0d6efd;
      --muted: #6c757d;
      --radius: 12px;
    }

    body {
      background: #f5f9ff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    .card-reset {
      width: 100%;
      max-width: 460px;
      border-radius: var(--radius);
      box-shadow: 0 8px 30px rgba(15, 30, 50, 0.08);
      overflow: hidden;
    }

    /* ðŸ”¹ Gradient header */
    .card-reset .card-header {
      background: linear-gradient(90deg, #4d88ff 0%, #89ddd9 100%);
      color: #fff;
      padding: 20px;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .card-reset .card-body {
      padding: 22px;
    }

    .form-control:focus {
      box-shadow: 0 0 0 0.15rem rgba(13,110,253,0.12);
      border-color: var(--brand);
    }

    .btn-reset {
      background: var(--brand);
      border-color: var(--brand);
      color: #fff;
      min-width: 160px;
    }
    .btn-reset:hover { background: #3584fb; border-color: #0b5ed7; }

    .pw-toggle {
      cursor: pointer;
      color: var(--muted);
      user-select: none;
    }

    .note { font-size: 13px; color: var(--muted); }
    .strength { height: 8px; border-radius: 6px; background: #e9ecef; overflow: hidden; }
    .strength > span { display: block; height: 100%; width: 0%; transition: width .25s ease; }
    .strength.weak > span { width: 30%; background: #dc3545; }
    .strength.medium > span { width: 60%; background: #ffc107; }
    .strength.strong > span { width: 100%; background: #198754; }

    .msg { margin-top: 12px; min-height: 22px; }
  </style>
</head>
<body>
  <div class="card card-reset">
    <div class="card-header">
      ðŸ”’ Reset your password
    </div>
    <div class="card-body">
      <p class="mb-3 note">Choose a new secure password for your account.</p>

      <form id="resetForm" novalidate>
        <div class="mb-3">
          <label class="form-label small">New password</label>
          <div class="input-group">
            <input id="pw" type="password" class="form-control" placeholder="At least 6 characters" minlength="6" required />
            <button id="togglePw" type="button" class="btn btn-outline-secondary pw-toggle">Show</button>
          </div>
          <div class="mt-2 d-flex align-items-center gap-2">
            <div class="strength" id="strength"><span></span></div>
            <small id="strengthText" class="note mb-0">Too short</small>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label small">Confirm password</label>
          <input id="pw2" type="password" class="form-control" placeholder="Repeat new password" minlength="6" required />
        </div>

        <div class="d-flex align-items-center gap-2">
          <button id="sendBtn" type="submit" class="btn btn-reset">
            <span id="sendText">Reset password</span>
            <span id="spinner" class="spinner-border spinner-border-sm ms-2" role="status" style="display:none"></span>
          </button>
          <a href="index.html" class="btn btn-outline-secondary">Back to login</a>
        </div>

        <div id="msg" class="msg"></div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // const API_BASE = 'http://localhost:5000/api/auth';
    const API_BASE = (window.APP_CONFIG && window.APP_CONFIG.API_BASE) || "http://localhost:5000/api/auth";

    function getQuery(name) { return new URL(window.location.href).searchParams.get(name); }
    const token = getQuery('token');

    const pw = document.getElementById('pw');
    const pw2 = document.getElementById('pw2');
    const togglePw = document.getElementById('togglePw');
    const strength = document.getElementById('strength');
    const strengthText = document.getElementById('strengthText');
    const msgEl = document.getElementById('msg');
    const sendBtn = document.getElementById('sendBtn');
    const spinner = document.getElementById('spinner');
    const sendText = document.getElementById('sendText');

    if (!token) {
      msgEl.textContent = 'Missing token â€” please use the link from your email.';
      msgEl.style.color = 'crimson';
    }

    togglePw.addEventListener('click', () => {
      const isPwd = pw.type === 'password';
      pw.type = isPwd ? 'text' : 'password';
      pw2.type = isPwd ? 'text' : 'password';
      togglePw.textContent = isPwd ? 'Hide' : 'Show';
    });

    pw.addEventListener('input', () => {
      const v = pw.value || ''; let score = 0;
      if (v.length >= 6) score++; if (/[A-Z]/.test(v)) score++; if (/[0-9]/.test(v)) score++; if (/[^A-Za-z0-9]/.test(v)) score++;
      if (v.length === 0) { strength.className='strength'; strengthText.textContent='Too short'; strengthText.style.color='var(--muted)'; }
      else if (score <= 1) { strength.className='strength weak'; strengthText.textContent='Weak'; strengthText.style.color='#dc3545'; }
      else if (score <= 3) { strength.className='strength medium'; strengthText.textContent='Medium'; strengthText.style.color='#d39e00'; }
      else { strength.className='strength strong'; strengthText.textContent='Strong'; strengthText.style.color='#198754'; }
    });

    document.getElementById('resetForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      msgEl.textContent = '';
      if (!token) return;
      const p1 = pw.value.trim(), p2 = pw2.value.trim();
      if (p1 !== p2) { msgEl.style.color='crimson'; msgEl.textContent='Passwords do not match.'; return; }

      sendBtn.disabled = true; spinner.style.display=''; sendText.textContent='Resetting...';
      try {
        const res = await fetch(`${API_BASE}/reset`, {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ token, password:p1 })
        });
        const data = await res.json().catch(()=>({}));
        if (res.ok) { msgEl.style.color='green'; msgEl.textContent=data.message||'Password changed! Redirecting...'; setTimeout(()=>{ window.location='index.html'; },1400); }
        else { msgEl.style.color='crimson'; msgEl.textContent=data.error||'Reset failed'; sendBtn.disabled=false; spinner.style.display='none'; sendText.textContent='Reset password'; }
      } catch (err) {
        msgEl.style.color='crimson'; msgEl.textContent='Network error â€” try again.'; sendBtn.disabled=false; spinner.style.display='none'; sendText.textContent='Reset password';
      }
    });
  </script>
 <script src="js/config.js"></script>
<script src="js/auth.js"></script>

</body>
</html>
